\#config-\/chain

U\+S\+E T\+H\+I\+S M\+O\+D\+U\+L\+E T\+O L\+O\+A\+D A\+L\+L Y\+O\+U\+R C\+O\+N\+F\+I\+G\+U\+R\+A\+T\+I\+O\+N\+S


\begin{DoxyCode}
1 //npm install config-chain
2 
3 var cc = require('config-chain')
4   , opts = require('optimist').argv //ALWAYS USE OPTIMIST FOR COMMAND LINE OPTIONS.
5   , env = opts.env || process.env.YOUR\_APP\_ENV || 'dev' //SET YOUR ENV LIKE THIS.
6 
7 // EACH ARG TO CONFIGURATOR IS LOADED INTO CONFIGURATION CHAIN
8 // EARLIER ITEMS OVERIDE LATER ITEMS
9 // PUTS COMMAND LINE OPTS FIRST, AND DEFAULTS LAST!
10 
11 //strings are interpereted as filenames.
12 //will be loaded synchronously
13 
14 var conf =
15 cc(
16   //OVERRIDE SETTINGS WITH COMMAND LINE OPTS
17   opts,
18 
19   //ENV VARS IF PREFIXED WITH 'myApp\_'
20 
21   cc.env('myApp\_'), //myApp\_foo = 'like this'
22 
23   //FILE NAMED BY ENV
24   path.join(\_\_dirname,  'config.' + env + '.json'),
25 
26   //IF `env` is PRODUCTION
27   env === 'prod'
28     ? path.join(\_\_dirname, 'special.json') //load a special file
29     : null //NULL IS IGNORED!
30 
31   //SUBDIR FOR ENV CONFIG
32   path.join(\_\_dirname,  'config', env, 'config.json'),
33 
34   //SEARCH PARENT DIRECTORIES FROM CURRENT DIR FOR FILE
35   cc.find('config.json'),
36 
37   //PUT DEFAULTS LAST
38   \{
39     host: 'localhost'
40     port: 8000
41   \})
42 
43 var host = conf.get('host')
44 
45 // or
46 
47 var host = conf.store.host
\end{DoxyCode}


F\+I\+N\+A\+L\+L\+Y, E\+A\+S\+Y F\+L\+E\+X\+I\+B\+L\+E C\+O\+N\+F\+I\+G\+U\+R\+A\+T\+I\+O\+N\+S!

\subsection*{see also\+: \href{https://github.com/isaacs/proto-list/}{\tt proto-\/list}}

W\+H\+A\+T\+S T\+H\+A\+T Y\+O\+U S\+A\+Y?

Y\+O\+U W\+A\+N\+T A \char`\"{}\+C\+L\+A\+S\+S\char`\"{} S\+O T\+H\+A\+T Y\+O\+U C\+A\+N D\+O C\+R\+A\+Y\+C\+R\+A\+Y J\+Q\+U\+E\+R\+Y C\+R\+A\+P\+S?

E\+X\+T\+E\+N\+D W\+I\+T\+H Y\+O\+U\+R O\+W\+N F\+U\+N\+C\+T\+I\+O\+N\+A\+L\+T\+Y!?

\subsection*{C\+O\+N\+F\+I\+G\+C\+H\+A\+I\+N L\+I\+V\+E\+S T\+O S\+E\+R\+V\+E O\+N\+L\+Y Y\+O\+U!}


\begin{DoxyCode}
1 var cc = require('config-chain')
2 
3 // all the stuff you did before
4 var config = cc(\{
5       some: 'object'
6     \},
7     cc.find('config.json'),
8     cc.env('myApp\_')
9   )
10   // CONFIGS AS A SERVICE, aka "CaaS", aka EVERY DEVOPS DREAM OMG!
11   .addUrl('http://configurator:1234/my-configs')
12   // ASYNC FTW!
13   .addFile('/path/to/file.json')
14 
15   // OBJECTS ARE OK TOO, they're SYNC but they still ORDER RIGHT
16   // BECAUSE PROMISES ARE USED BUT NO, NOT *THOSE* PROMISES, JUST
17   // ACTUAL PROMISES LIKE YOU MAKE TO YOUR MOM, KEPT OUT OF LOVE
18   .add(\{ another: 'object' \})
19 
20   // DIE A THOUSAND DEATHS IF THIS EVER HAPPENS!!
21   .on('error', function (er) \{
22     // IF ONLY THERE WAS SOMETHIGN HARDER THAN THROW
23     // MY SORROW COULD BE ADEQUATELY EXPRESSED.  /o\(\backslash\)
24     throw er
25   \})
26 
27   // THROW A PARTY IN YOUR FACE WHEN ITS ALL LOADED!!
28   .on('load', function (config) \{
29     console.awesome('HOLY SHIT!')
30   \})
\end{DoxyCode}


\section*{B\+O\+R\+I\+N\+G A\+P\+I D\+O\+C\+S}

\subsection*{cc(...args)}

M\+A\+K\+E A C\+H\+A\+I\+N A\+N\+D A\+D\+D A\+L\+L T\+H\+E A\+R\+G\+S.

If the arg is a S\+T\+R\+I\+N\+G, then it shall be a J\+S\+O\+N F\+I\+L\+E\+N\+A\+M\+E.

S\+Y\+N\+C I/\+O!

R\+E\+T\+U\+R\+N T\+H\+E C\+H\+A\+I\+N!

\subsection*{cc.\+json(...args)}

Join the args I\+N\+T\+O A J\+S\+O\+N F\+I\+L\+E\+N\+A\+M\+E!

S\+Y\+N\+C I/\+O!

\subsection*{cc.\+find(relative\+Path)}

S\+E\+E\+K the R\+E\+L\+A\+T\+I\+V\+E P\+A\+T\+H by climbing the T\+R\+E\+E O\+F D\+I\+R\+E\+C\+T\+O\+R\+I\+E\+S.

R\+E\+T\+U\+R\+N T\+H\+E F\+O\+U\+N\+D P\+A\+T\+H!

S\+Y\+N\+C I/\+O!

\subsection*{cc.\+parse(content, file, type)}

Parse the content string, and guess the type from either the specified type or the filename.

R\+E\+T\+U\+R\+N T\+H\+E R\+E\+S\+U\+L\+T\+I\+N\+G O\+B\+J\+E\+C\+T!

N\+O I/\+O!

\subsection*{cc.\+env(prefix, env=process.\+env)}

Get all the keys on the provided env object (or process.\+env) which are prefixed by the specified prefix, and put the values on a new object.

R\+E\+T\+U\+R\+N T\+H\+E R\+E\+S\+U\+L\+T\+I\+N\+G O\+B\+J\+E\+C\+T!

N\+O I/\+O!

\subsection*{cc.\+Config\+Chain()}

The Config\+Chain class for C\+R\+A\+Y C\+R\+A\+Y J\+Q\+U\+E\+R\+Y S\+T\+Y\+L\+E M\+E\+T\+H\+O\+D C\+H\+A\+I\+N\+I\+N\+G!

One of these is returned by the main exported function, as well.

It inherits (prototypically) from \href{https://github.com/isaacs/proto-list/}{\tt Proto\+List}, and also inherits (parasitically) from \href{http://nodejs.org/api/events.html#events_class_events_eventemitter}{\tt Event\+Emitter}

It has all the methods from both, and except where noted, they are unchanged.

\subsubsection*{L\+E\+T I\+T B\+E K\+N\+O\+W\+N T\+H\+A\+T chain I\+S A\+N I\+N\+S\+T\+A\+N\+C\+E O\+F Config\+Chain.}

\subsection*{chain.\+sources}

A list of all the places where it got stuff. The keys are the names passed to add\+File or add\+Url etc, and the value is an object with some info about the data source.

\subsection*{chain.\+add\+File(filename, type, \mbox{[}name=filename\mbox{]})}

Filename is the name of the file. Name is an arbitrary string to be used later if you desire. Type is either \textquotesingle{}ini\textquotesingle{} or \textquotesingle{}json\textquotesingle{}, and will try to guess intelligently if omitted.

Loaded files can be saved later.

\subsection*{chain.\+add\+Url(url, type, \mbox{[}name=url\mbox{]})}

Same as the filename thing, but with a url.

Can\textquotesingle{}t be saved later.

\subsection*{chain.\+add\+Env(prefix, env, \mbox{[}name=\textquotesingle{}env\textquotesingle{}\mbox{]})}

Add all the keys from the env object that start with the prefix.

\subsection*{chain.\+add\+String(data, file, type, \mbox{[}name\mbox{]})}

Parse the string and add it to the set. (Mainly used internally.)

\subsection*{chain.\+add(object, \mbox{[}name\mbox{]})}

Add the object to the set.

\subsection*{chain.\+root \{Object\}}

The root from which all the other config objects in the set descend prototypically.

Put your defaults here.

\subsection*{chain.\+set(key, value, name)}

Set the key to the value on the named config object. If name is unset, then set it on the first config object in the set. (That is, the one with the highest priority, which was added first.)

\subsection*{chain.\+get(key, \mbox{[}name\mbox{]})}

Get the key from the named config object explicitly, or from the resolved configs if not specified.

\subsection*{chain.\+save(name, type)}

Write the named config object back to its origin.

Currently only supported for env and file config types.

For files, encode the data according to the type.

\subsection*{chain.\+on(\textquotesingle{}save\textquotesingle{}, function () \{\})}

When one or more files are saved, emits {\ttfamily save} event when they\textquotesingle{}re all saved.

\subsection*{chain.\+on(\textquotesingle{}load\textquotesingle{}, function (chain) \{\})}

When the config chain has loaded all the specified files and urls and such, the \textquotesingle{}load\textquotesingle{} event fires. 