\href{https://npmjs.org/package/grunt-template-jasmine-istanbul}{\tt !\mbox{[}N\+P\+M version\mbox{]}\mbox{[}npm-\/image\mbox{]}} \href{https://travis-ci.org/maenu/grunt-template-jasmine-istanbul}{\tt !\mbox{[}build status\mbox{]}\mbox{[}travis-\/image\mbox{]}} \href{https://npmjs.org/package/grunt-template-jasmine-istanbul}{\tt !\mbox{[}Downloads\mbox{]}\mbox{[}downloads-\/image\mbox{]}}

\section*{Code coverage template mix-\/in for \href{https://github.com/gruntjs/grunt-contrib-jasmine}{\tt grunt-\/contrib-\/jasmine}, using \href{https://github.com/gotwarlost/istanbul}{\tt istanbul}}

\subsection*{Installation}


\begin{DoxyCode}
1 npm install grunt-template-jasmine-istanbul --save-dev
\end{DoxyCode}


\subsection*{Template Options}

\subsubsection*{template\+Options.\+coverage}

Type\+: {\ttfamily String} Mandatory.

The file path where to store the {\ttfamily coverage.\+json}.

\subsubsection*{template\+Options.\+report}

Type\+: {\ttfamily String $\vert$ Object $\vert$ Array} Mandatory.

If a {\ttfamily String} is given, it will be used as the path where a H\+T\+M\+L report is generated. If an {\ttfamily Object} is given, it must have the properties {\ttfamily type} and {\ttfamily options}, where {\ttfamily type} is a {\ttfamily String} and {\ttfamily options} an {\ttfamily Object}. {\ttfamily type} and {\ttfamily options} are used to create the report by passing it to {\ttfamily istanbul}s \href{http://gotwarlost.github.com/istanbul/public/apidocs/classes/Report.html}{\tt `\+Report.create(type, options)`}. For example, if you want to generate a Cobertura report at {\ttfamily bin/coverage/cobertura}, use this\+:


\begin{DoxyCode}
report: \{
    type: \textcolor{stringliteral}{'cobertura'},
    options: \{
        dir: \textcolor{stringliteral}{'bin/coverage/cobertura'}
    \}
\}
\end{DoxyCode}


If an {\ttfamily Array} is given, it must consist of {\ttfamily Object}s of the form just described.

The supported types are\+:


\begin{DoxyItemize}
\item \href{http://gotwarlost.github.com/istanbul/public/apidocs/classes/HtmlReport.html}{\tt `html`}
\item \href{http://gotwarlost.github.com/istanbul/public/apidocs/classes/TextReport.html}{\tt `text`}
\item \href{http://gotwarlost.github.com/istanbul/public/apidocs/classes/TextSummaryReport.html}{\tt `text-\/summary`}
\item \href{http://gotwarlost.github.com/istanbul/public/apidocs/classes/LcovReport.html}{\tt `lcov`}
\item \href{http://gotwarlost.github.com/istanbul/public/apidocs/classes/LcovOnlyReport.html}{\tt `lcovonly`}
\item \href{http://gotwarlost.github.com/istanbul/public/apidocs/classes/CoberturaReport.html}{\tt `cobertura`}
\end{DoxyItemize}

\subsubsection*{template\+Options.\+files}

Type\+: {\ttfamily String$\vert$\+Array} Default\+: {\ttfamily $\ast$$\ast$/$\ast$}

A globbing pattern or multiple patterns for the source files to instrument. All source files that do match will be instrumented, those who don\textquotesingle{}t won\textquotesingle{}t. E.\+g. `\mbox{[}\textquotesingle{}$\ast$$\ast$/$\ast$\textquotesingle{}, \textquotesingle{}!src/main/js/uninteresting.js\textquotesingle{}\mbox{]}{\ttfamily will result in all source files being instrumented except}src/main/js/uninteresting.\+js`.

\subsubsection*{template\+Options.\+replace}

Type\+: {\ttfamily Boolean$\vert$\+Function} Default\+: {\ttfamily true}

Whether or not the {\ttfamily src} scripts are replaced by the paths to their instrumented versions. This is useful when you want the mixed-\/in template to work with the original sources, and you want to serve the instrumented sources by redirecting request on the server side. If you don\textquotesingle{}t want the sources to be replaced, set it to {\ttfamily false}. If it is a function, it receives the arguments {\ttfamily Ã¬nstrumented\+Source} and {\ttfamily source} which represent the U\+R\+I to the instrumented file and the uninstrumented file respectively, relative to the directory specified by \href{https://github.com/gruntjs/grunt-contrib-jasmine#optionsoutfile}{\tt `outfile`}.

\subsubsection*{template\+Options.\+thresholds}

Type\+: {\ttfamily Object} Default\+: {\ttfamily undefined}

Thresholds for any of the metrics that Istanbul measures. If a threshold is not met, a warning is emitted. See example below for available metrics.

\subsubsection*{template\+Options.\+template}

Type\+: {\ttfamily String $\vert$ Object} Default\+: jasmine\textquotesingle{}s default template

The template to mix-\/in coverage.

\subsubsection*{template\+Options.\+template\+Options}

Type\+: {\ttfamily Object} Default\+: {\ttfamily undefined}

The options to pass to the mixed-\/in template.

\subsection*{Examples}

There are multiple examples at a \href{https://github.com/maenu/grunt-template-jasmine-istanbul-example}{\tt example repository}.

\subsubsection*{Simple}

Have a look at \href{https://github.com/maenu/grunt-template-jasmine-istanbul-example}{\tt this example}.


\begin{DoxyCode}
\textcolor{comment}{// Example configuration}
grunt.initConfig(\{
    jasmine: \{
        coverage: \{
            src: [\textcolor{stringliteral}{'src/main/js/*.js'}],
            options: \{
                specs: [\textcolor{stringliteral}{'src/test/js/*.js'}],
                \textcolor{keyword}{template}: require(\textcolor{stringliteral}{'grunt-template-jasmine-istanbul'}),
                templateOptions: \{
                    coverage: \textcolor{stringliteral}{'bin/coverage/coverage.json'},
                    report: \textcolor{stringliteral}{'bin/coverage'},
                    thresholds: \{
                        lines: 75,
                        statements: 75,
                        branches: 75,
                        functions: 90
                    \}
                \}
            \}
        \}
    \}
\}
\end{DoxyCode}


\subsubsection*{Require\+J\+S}

Have a look at \href{https://github.com/maenu/grunt-template-jasmine-istanbul-example/tree/requirejs}{\tt this example}. Note that you need to configure the {\ttfamily base\+Url} to point to the instrumented sources, as described in the section \href{https://github.com/maenu/grunt-template-jasmine-istanbul#a-single-arequirement}{\tt below}.


\begin{DoxyCode}
grunt.initConfig(\{
    jasmine: \{
        coverage: \{
            src: [\textcolor{stringliteral}{'src/main/js/*.js'}],
            options: \{
                specs: [\textcolor{stringliteral}{'src/test/js/*.js'}],
                \textcolor{keyword}{template}: require(\textcolor{stringliteral}{'grunt-template-jasmine-istanbul'}),
                templateOptions: \{
                    coverage: \textcolor{stringliteral}{'bin/coverage/coverage.json'},
                    report: \textcolor{stringliteral}{'bin/coverage'},
                    \textcolor{keyword}{template}: require(\textcolor{stringliteral}{'grunt-template-jasmine-requirejs'}),
                    templateOptions: \{
                        requireConfig: \{
                            baseUrl: \textcolor{stringliteral}{'.grunt/grunt-contrib-jasmine/src/main/js/'}
                        \}
                    \}
                \}
            \}
        \}
    \}
\}
\end{DoxyCode}


\paragraph*{Is it really that easy?}

No.

Setting {\ttfamily base\+Url} to that location may screw up your whole configuration, because paths relative to the original sources are broken. Therefore, if this happens to you, instead of directly loading the instrumented sources, set {\ttfamily replace\+: false}, intercept request to the original sources and redirect them to the instrumented versions. You can do this on both the \href{https://github.com/maenu/grunt-template-jasmine-istanbul-example/tree/requirejs-client}{\tt client side}, or the \href{https://github.com/maenu/grunt-template-jasmine-istanbul-example/tree/requirejs-server}{\tt server side}. Look at the corresponding {\ttfamily Grunfile.\+js} files and be filled with horror\+: Yes, this is nasty, but it (seems to) works.

\subsection*{Mixed-\/in Templates}

\subsubsection*{The Idea}

Do you have another template you want to use, but you also want to collect code coverage at the same time? Then you can use a mixed-\/in template, that\textquotesingle{}s what they are for. The idea behind a mixed-\/in template is simple\+: Istanbul generates code coverage information by instrumenting the sources before they are run and by generating reports after they have run. Therefore this templates acts as a test pre-\/ and post-\/processor, but it doesn\textquotesingle{}t interfere with the actual running of the tests. This makes it possible to use another template as a mix-\/in template to run the tests, defined by {\ttfamily template\+Options.\+template} and can be configured with {\ttfamily template\+Options.\+template\+Options}.

\subsubsection*{A Single Requirement}

A mixed-\/in template needs to load the instrumented sources in order for the coverage reports to be correctly generated. This template copies instrumented versions of the sources to a temporary location at {\ttfamily .grunt/grunt-\/contrib-\/jasmine/}. If your mixed-\/in template simply includes the sources, as the default template does, you don\textquotesingle{}t need to account for that, since this template replaces the {\ttfamily src} option with the paths to the instrumented versions. If your mixed-\/in template loads the sources differently, e.\+g. directly from the file system, you may need to reconfigure the mixed-\/in template.

\subsection*{Change Log}


\begin{DoxyItemize}
\item v0.\+3.\+4, 28.\+06.\+15, closes \href{https://github.com/maenu/grunt-template-jasmine-istanbul/issues/40}{\tt \#40}, Don\textquotesingle{}t throw error in reporter if coverage was not run.
\item v0.\+3.\+3, 27.\+01.\+15, closes \href{https://github.com/maenu/grunt-template-jasmine-istanbul/issues/36}{\tt \#36}, require lodash 3
\item v0.\+3.\+2, 23.\+01.\+15, closes \href{https://github.com/maenu/grunt-template-jasmine-istanbul/issues/33}{\tt \#33} and \href{https://github.com/maenu/grunt-template-jasmine-istanbul/issues/28}{\tt \#28}
\item v0.\+3.\+1, 02.\+02.\+14, closes \href{https://github.com/maenu/grunt-template-jasmine-istanbul/issues/14}{\tt \#14} and \href{https://github.com/maenu/grunt-template-jasmine-istanbul/issues/17}{\tt \#17}, added {\ttfamily files} option and function support for {\ttfamily replace} option
\item v0.\+3.\+0, 02.\+02.\+14, fixes \href{https://github.com/maenu/grunt-template-jasmine-istanbul/issues/18}{\tt \#18} and \href{https://github.com/maenu/grunt-template-jasmine-istanbul/issues/26}{\tt \#26}, now requires grunt-\/contrib-\/jasmine v0.\+6.\+0
\item v0.\+2.\+6, 02.\+02.\+14, merged \href{https://github.com/maenu/grunt-template-jasmine-istanbul/issues/13}{\tt \#13} from , windows paths are converted to U\+R\+Is
\item v0.\+2.\+5, 10.\+08.\+13, reporter is now moved to and loaded from jasmine\textquotesingle{}s temporary directory, fixes \href{https://github.com/maenu/grunt-template-jasmine-istanbul/issues/11}{\tt \#11}
\item v0.\+2.\+4, 26.\+05.\+13, merged \href{https://github.com/maenu/grunt-template-jasmine-istanbul/issues/12}{\tt \#12} from , instrumented versions of files loaded via absolute paths on windows are now created at a valid path
\item v0.\+2.\+3, 12.\+05.\+13, merged {\ttfamily thresholds} from  \href{https://github.com/maenu/grunt-template-jasmine-istanbul/issues/9}{\tt \#9} which can abort a build with too low coverage
\item v0.\+2.\+2, 11.\+05.\+13, added {\ttfamily replace} option, so it can be prevented that the original {\ttfamily src} option is replaced with their instrumented versions 
\end{DoxyItemize}