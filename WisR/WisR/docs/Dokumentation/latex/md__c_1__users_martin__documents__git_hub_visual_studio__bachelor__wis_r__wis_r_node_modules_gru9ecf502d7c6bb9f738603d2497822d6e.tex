Add callbacks to requests in flight to avoid async duplication

\subsection*{U\+S\+A\+G\+E}


\begin{DoxyCode}
1 var inflight = require('inflight')
2 
3 // some request that does some stuff
4 function req(key, callback) \{
5   // key is any random string.  like a url or filename or whatever.
6   //
7   // will return either a falsey value, indicating that the
8   // request for this key is already in flight, or a new callback
9   // which when called will call all callbacks passed to inflightk
10   // with the same key
11   callback = inflight(key, callback)
12 
13   // If we got a falsey value back, then there's already a req going
14   if (!callback) return
15 
16   // this is where you'd fetch the url or whatever
17   // callback is also once()-ified, so it can safely be assigned
18   // to multiple events etc.  First call wins.
19   setTimeout(function() \{
20     callback(null, key)
21   \}, 100)
22 \}
23 
24 // only assigns a single setTimeout
25 // when it dings, all cbs get called
26 req('foo', cb1)
27 req('foo', cb2)
28 req('foo', cb3)
29 req('foo', cb4)
\end{DoxyCode}
 