<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>WisR web applikation: C:/Users/martin/Documents/GitHubVisualStudio/Bachelor/WisR/WisR/Scripts/angular-touch.js</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">WisR web applikation
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">C:/Users/martin/Documents/GitHubVisualStudio/Bachelor/WisR/WisR/Scripts/angular-touch.js</div>  </div>
</div><!--header-->
<div class="contents">
<p>&lt;file name="index.html"&gt; &lt;button ng-click="count = count + 1" ng-init="count=0"&gt; Increment &lt;/button&gt; count: {{ count }} &lt;/file&gt; &lt;file name="script.js"&gt; angular.module('ngClickExample', ['ngTouch']); &lt;/file&gt; </p>
<div class="fragment"><div class="line"></div>
<div class="line">(<span class="keyword">function</span>(window, angular, undefined) {<span class="stringliteral">&#39;use strict&#39;</span>;</div>
<div class="line"></div>
<div class="line"><span class="comment">// define ngTouch module</span></div>
<div class="line"><span class="comment">/* global -ngTouch */</span></div>
<div class="line">var ngTouch = angular.module(<span class="stringliteral">&#39;ngTouch&#39;</span>, []);</div>
<div class="line"></div>
<div class="line"><span class="keyword">function</span> nodeName_(element) {</div>
<div class="line">  <span class="keywordflow">return</span> angular.lowercase(element.nodeName || (element[0] &amp;&amp; element[0].nodeName));</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/* global ngTouch: false */</span></div>
<div class="line"></div>
<div class="line">ngTouch.factory(<span class="stringliteral">&#39;$swipe&#39;</span>, [<span class="keyword">function</span>() {</div>
<div class="line">  <span class="comment">// The total distance in any direction before we make the call on swipe vs. scroll.</span></div>
<div class="line">  var MOVE_BUFFER_RADIUS = 10;</div>
<div class="line"></div>
<div class="line">  var POINTER_EVENTS = {</div>
<div class="line">    <span class="stringliteral">&#39;mouse&#39;</span>: {</div>
<div class="line">      start: <span class="stringliteral">&#39;mousedown&#39;</span>,</div>
<div class="line">      move: <span class="stringliteral">&#39;mousemove&#39;</span>,</div>
<div class="line">      end: <span class="stringliteral">&#39;mouseup&#39;</span></div>
<div class="line">    },</div>
<div class="line">    <span class="stringliteral">&#39;touch&#39;</span>: {</div>
<div class="line">      start: <span class="stringliteral">&#39;touchstart&#39;</span>,</div>
<div class="line">      move: <span class="stringliteral">&#39;touchmove&#39;</span>,</div>
<div class="line">      end: <span class="stringliteral">&#39;touchend&#39;</span>,</div>
<div class="line">      cancel: <span class="stringliteral">&#39;touchcancel&#39;</span></div>
<div class="line">    }</div>
<div class="line">  };</div>
<div class="line"></div>
<div class="line">  <span class="keyword">function</span> getCoordinates(event) {</div>
<div class="line">    var originalEvent = <span class="keyword">event</span>.originalEvent || event;</div>
<div class="line">    var touches = originalEvent.touches &amp;&amp; originalEvent.touches.length ? originalEvent.touches : [originalEvent];</div>
<div class="line">    var e = (originalEvent.changedTouches &amp;&amp; originalEvent.changedTouches[0]) || touches[0];</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> {</div>
<div class="line">      x: e.clientX,</div>
<div class="line">      y: e.clientY</div>
<div class="line">    };</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keyword">function</span> getEvents(pointerTypes, eventType) {</div>
<div class="line">    var res = [];</div>
<div class="line">    angular.forEach(pointerTypes, <span class="keyword">function</span>(pointerType) {</div>
<div class="line">      var eventName = POINTER_EVENTS[pointerType][eventType];</div>
<div class="line">      <span class="keywordflow">if</span> (eventName) {</div>
<div class="line">        res.push(eventName);</div>
<div class="line">      }</div>
<div class="line">    });</div>
<div class="line">    <span class="keywordflow">return</span> res.join(<span class="charliteral">&#39; &#39;</span>);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> {</div>
<div class="line">    bind: <span class="keyword">function</span>(element, eventHandlers, pointerTypes) {</div>
<div class="line">      <span class="comment">// Absolute total movement, used to control swipe vs. scroll.</span></div>
<div class="line">      var totalX, totalY;</div>
<div class="line">      <span class="comment">// Coordinates of the start position.</span></div>
<div class="line">      var startCoords;</div>
<div class="line">      <span class="comment">// Last event&#39;s position.</span></div>
<div class="line">      var lastPos;</div>
<div class="line">      <span class="comment">// Whether a swipe is active.</span></div>
<div class="line">      var active = <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line">      pointerTypes = pointerTypes || [<span class="stringliteral">&#39;mouse&#39;</span>, <span class="stringliteral">&#39;touch&#39;</span>];</div>
<div class="line">      element.on(getEvents(pointerTypes, <span class="stringliteral">&#39;start&#39;</span>), <span class="keyword">function</span>(event) {</div>
<div class="line">        startCoords = getCoordinates(event);</div>
<div class="line">        active = <span class="keyword">true</span>;</div>
<div class="line">        totalX = 0;</div>
<div class="line">        totalY = 0;</div>
<div class="line">        lastPos = startCoords;</div>
<div class="line">        eventHandlers[<span class="stringliteral">&#39;start&#39;</span>] &amp;&amp; eventHandlers[<span class="stringliteral">&#39;start&#39;</span>](startCoords, event);</div>
<div class="line">      });</div>
<div class="line">      var events = getEvents(pointerTypes, <span class="stringliteral">&#39;cancel&#39;</span>);</div>
<div class="line">      <span class="keywordflow">if</span> (events) {</div>
<div class="line">        element.on(events, <span class="keyword">function</span>(event) {</div>
<div class="line">          active = <span class="keyword">false</span>;</div>
<div class="line">          eventHandlers[<span class="stringliteral">&#39;cancel&#39;</span>] &amp;&amp; eventHandlers[<span class="stringliteral">&#39;cancel&#39;</span>](event);</div>
<div class="line">        });</div>
<div class="line">      }</div>
<div class="line"></div>
<div class="line">      element.on(getEvents(pointerTypes, <span class="stringliteral">&#39;move&#39;</span>), <span class="keyword">function</span>(event) {</div>
<div class="line">        <span class="keywordflow">if</span> (!active) <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Android will send a touchcancel if it thinks we&#39;re starting to scroll.</span></div>
<div class="line">        <span class="comment">// So when the total distance (+ or - or both) exceeds 10px in either direction,</span></div>
<div class="line">        <span class="comment">// we either:</span></div>
<div class="line">        <span class="comment">// - On totalX &gt; totalY, we send preventDefault() and treat this as a swipe.</span></div>
<div class="line">        <span class="comment">// - On totalY &gt; totalX, we let the browser handle it as a scroll.</span></div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (!startCoords) <span class="keywordflow">return</span>;</div>
<div class="line">        var coords = getCoordinates(event);</div>
<div class="line"></div>
<div class="line">        totalX += Math.abs(coords.x - lastPos.x);</div>
<div class="line">        totalY += Math.abs(coords.y - lastPos.y);</div>
<div class="line"></div>
<div class="line">        lastPos = coords;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (totalX &lt; MOVE_BUFFER_RADIUS &amp;&amp; totalY &lt; MOVE_BUFFER_RADIUS) {</div>
<div class="line">          <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// One of totalX or totalY has exceeded the buffer, so decide on swipe vs. scroll.</span></div>
<div class="line">        <span class="keywordflow">if</span> (totalY &gt; totalX) {</div>
<div class="line">          <span class="comment">// Allow native scrolling to take over.</span></div>
<div class="line">          active = <span class="keyword">false</span>;</div>
<div class="line">          eventHandlers[<span class="stringliteral">&#39;cancel&#39;</span>] &amp;&amp; eventHandlers[<span class="stringliteral">&#39;cancel&#39;</span>](event);</div>
<div class="line">          <span class="keywordflow">return</span>;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">          <span class="comment">// Prevent the browser from scrolling.</span></div>
<div class="line">          <span class="keyword">event</span>.preventDefault();</div>
<div class="line">          eventHandlers[<span class="stringliteral">&#39;move&#39;</span>] &amp;&amp; eventHandlers[<span class="stringliteral">&#39;move&#39;</span>](coords, event);</div>
<div class="line">        }</div>
<div class="line">      });</div>
<div class="line"></div>
<div class="line">      element.on(getEvents(pointerTypes, <span class="stringliteral">&#39;end&#39;</span>), <span class="keyword">function</span>(event) {</div>
<div class="line">        <span class="keywordflow">if</span> (!active) <span class="keywordflow">return</span>;</div>
<div class="line">        active = <span class="keyword">false</span>;</div>
<div class="line">        eventHandlers[<span class="stringliteral">&#39;end&#39;</span>] &amp;&amp; eventHandlers[<span class="stringliteral">&#39;end&#39;</span>](getCoordinates(event), event);</div>
<div class="line">      });</div>
<div class="line">    }</div>
<div class="line">  };</div>
<div class="line">}]);</div>
<div class="line"></div>
<div class="line"><span class="comment">/* global ngTouch: false,</span></div>
<div class="line"><span class="comment">  nodeName_: false</span></div>
<div class="line"><span class="comment">*/</span></div>
<div class="line"></div>
<div class="line">ngTouch.config([<span class="stringliteral">&#39;$provide&#39;</span>, <span class="keyword">function</span>($provide) {</div>
<div class="line">  $provide.decorator(<span class="stringliteral">&#39;ngClickDirective&#39;</span>, [<span class="stringliteral">&#39;$delegate&#39;</span>, <span class="keyword">function</span>($delegate) {</div>
<div class="line">    <span class="comment">// drop the default ngClick directive</span></div>
<div class="line">    $delegate.shift();</div>
<div class="line">    <span class="keywordflow">return</span> $delegate;</div>
<div class="line">  }]);</div>
<div class="line">}]);</div>
<div class="line"></div>
<div class="line">ngTouch.directive(<span class="stringliteral">&#39;ngClick&#39;</span>, [<span class="stringliteral">&#39;$parse&#39;</span>, <span class="stringliteral">&#39;$timeout&#39;</span>, <span class="stringliteral">&#39;$rootElement&#39;</span>,</div>
<div class="line">    <span class="keyword">function</span>($parse, $timeout, $rootElement) {</div>
<div class="line">  var TAP_DURATION = 750; <span class="comment">// Shorter than 750ms is a tap, longer is a taphold or drag.</span></div>
<div class="line">  var MOVE_TOLERANCE = 12; <span class="comment">// 12px seems to work in most mobile browsers.</span></div>
<div class="line">  var PREVENT_DURATION = 2500; <span class="comment">// 2.5 seconds maximum from preventGhostClick call to click</span></div>
<div class="line">  var CLICKBUSTER_THRESHOLD = 25; <span class="comment">// 25 pixels in any dimension is the limit for busting clicks.</span></div>
<div class="line"></div>
<div class="line">  var ACTIVE_CLASS_NAME = <span class="stringliteral">&#39;ng-click-active&#39;</span>;</div>
<div class="line">  var lastPreventedTime;</div>
<div class="line">  var touchCoordinates;</div>
<div class="line">  var lastLabelClickCoordinates;</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">// TAP EVENTS AND GHOST CLICKS</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Why tap events?</span></div>
<div class="line">  <span class="comment">// Mobile browsers detect a tap, then wait a moment (usually ~300ms) to see if you&#39;re</span></div>
<div class="line">  <span class="comment">// double-tapping, and then fire a click event.</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// This delay sucks and makes mobile apps feel unresponsive.</span></div>
<div class="line">  <span class="comment">// So we detect touchstart, touchcancel and touchend ourselves and determine when</span></div>
<div class="line">  <span class="comment">// the user has tapped on something.</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// What happens when the browser then generates a click event?</span></div>
<div class="line">  <span class="comment">// The browser, of course, also detects the tap and fires a click after a delay. This results in</span></div>
<div class="line">  <span class="comment">// tapping/clicking twice. We do &quot;clickbusting&quot; to prevent it.</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// How does it work?</span></div>
<div class="line">  <span class="comment">// We attach global touchstart and click handlers, that run during the capture (early) phase.</span></div>
<div class="line">  <span class="comment">// So the sequence for a tap is:</span></div>
<div class="line">  <span class="comment">// - global touchstart: Sets an &quot;allowable region&quot; at the point touched.</span></div>
<div class="line">  <span class="comment">// - element&#39;s touchstart: Starts a touch</span></div>
<div class="line">  <span class="comment">// (- touchcancel ends the touch, no click follows)</span></div>
<div class="line">  <span class="comment">// - element&#39;s touchend: Determines if the tap is valid (didn&#39;t move too far away, didn&#39;t hold</span></div>
<div class="line">  <span class="comment">//   too long) and fires the user&#39;s tap handler. The touchend also calls preventGhostClick().</span></div>
<div class="line">  <span class="comment">// - preventGhostClick() removes the allowable region the global touchstart created.</span></div>
<div class="line">  <span class="comment">// - The browser generates a click event.</span></div>
<div class="line">  <span class="comment">// - The global click handler catches the click, and checks whether it was in an allowable region.</span></div>
<div class="line">  <span class="comment">//     - If preventGhostClick was called, the region will have been removed, the click is busted.</span></div>
<div class="line">  <span class="comment">//     - If the region is still there, the click proceeds normally. Therefore clicks on links and</span></div>
<div class="line">  <span class="comment">//       other elements without ngTap on them work normally.</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// This is an ugly, terrible hack!</span></div>
<div class="line">  <span class="comment">// Yeah, tell me about it. The alternatives are using the slow click events, or making our users</span></div>
<div class="line">  <span class="comment">// deal with the ghost clicks, so I consider this the least of evils. Fortunately Angular</span></div>
<div class="line">  <span class="comment">// encapsulates this ugly logic away from the user.</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Why not just put click handlers on the element?</span></div>
<div class="line">  <span class="comment">// We do that too, just to be sure. If the tap event caused the DOM to change,</span></div>
<div class="line">  <span class="comment">// it is possible another element is now in that position. To take account for these possibly</span></div>
<div class="line">  <span class="comment">// distinct elements, the handlers are global and care only about coordinates.</span></div>
<div class="line"></div>
<div class="line">  <span class="comment">// Checks if the coordinates are close enough to be within the region.</span></div>
<div class="line">  <span class="keyword">function</span> hit(x1, y1, x2, y2) {</div>
<div class="line">    <span class="keywordflow">return</span> Math.abs(x1 - x2) &lt; CLICKBUSTER_THRESHOLD &amp;&amp; Math.abs(y1 - y2) &lt; CLICKBUSTER_THRESHOLD;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Checks a list of allowable regions against a click location.</span></div>
<div class="line">  <span class="comment">// Returns true if the click should be allowed.</span></div>
<div class="line">  <span class="comment">// Splices out the allowable region from the list after it has been used.</span></div>
<div class="line">  <span class="keyword">function</span> checkAllowableRegions(touchCoordinates, x, y) {</div>
<div class="line">    <span class="keywordflow">for</span> (var i = 0; i &lt; touchCoordinates.length; i += 2) {</div>
<div class="line">      <span class="keywordflow">if</span> (hit(touchCoordinates[i], touchCoordinates[i + 1], x, y)) {</div>
<div class="line">        touchCoordinates.splice(i, i + 2);</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>; <span class="comment">// allowable region</span></div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// No allowable region; bust it.</span></div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Global click handler that prevents the click if it&#39;s in a bustable zone and preventGhostClick</span></div>
<div class="line">  <span class="comment">// was called recently.</span></div>
<div class="line">  <span class="keyword">function</span> onClick(event) {</div>
<div class="line">    <span class="keywordflow">if</span> (Date.now() - lastPreventedTime &gt; PREVENT_DURATION) {</div>
<div class="line">      <span class="keywordflow">return</span>; <span class="comment">// Too old.</span></div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    var touches = <span class="keyword">event</span>.touches &amp;&amp; <span class="keyword">event</span>.touches.length ? <span class="keyword">event</span>.touches : [event];</div>
<div class="line">    var x = touches[0].clientX;</div>
<div class="line">    var y = touches[0].clientY;</div>
<div class="line">    <span class="comment">// Work around desktop Webkit quirk where clicking a label will fire two clicks (on the label</span></div>
<div class="line">    <span class="comment">// and on the input element). Depending on the exact browser, this second click we don&#39;t want</span></div>
<div class="line">    <span class="comment">// to bust has either (0,0), negative coordinates, or coordinates equal to triggering label</span></div>
<div class="line">    <span class="comment">// click event</span></div>
<div class="line">    <span class="keywordflow">if</span> (x &lt; 1 &amp;&amp; y &lt; 1) {</div>
<div class="line">      <span class="keywordflow">return</span>; <span class="comment">// offscreen</span></div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (lastLabelClickCoordinates &amp;&amp;</div>
<div class="line">        lastLabelClickCoordinates[0] === x &amp;&amp; lastLabelClickCoordinates[1] === y) {</div>
<div class="line">      <span class="keywordflow">return</span>; <span class="comment">// input click triggered by label click</span></div>
<div class="line">    }</div>
<div class="line">    <span class="comment">// reset label click coordinates on first subsequent click</span></div>
<div class="line">    <span class="keywordflow">if</span> (lastLabelClickCoordinates) {</div>
<div class="line">      lastLabelClickCoordinates = null;</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">// remember label click coordinates to prevent click busting of trigger click event on input</span></div>
<div class="line">    <span class="keywordflow">if</span> (nodeName_(event.target) === <span class="stringliteral">&#39;label&#39;</span>) {</div>
<div class="line">      lastLabelClickCoordinates = [x, y];</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Look for an allowable region containing this click.</span></div>
<div class="line">    <span class="comment">// If we find one, that means it was created by touchstart and not removed by</span></div>
<div class="line">    <span class="comment">// preventGhostClick, so we don&#39;t bust it.</span></div>
<div class="line">    <span class="keywordflow">if</span> (checkAllowableRegions(touchCoordinates, x, y)) {</div>
<div class="line">      <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// If we didn&#39;t find an allowable region, bust the click.</span></div>
<div class="line">    <span class="keyword">event</span>.stopPropagation();</div>
<div class="line">    <span class="keyword">event</span>.preventDefault();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Blur focused form elements</span></div>
<div class="line">    <span class="keyword">event</span>.target &amp;&amp; <span class="keyword">event</span>.target.blur &amp;&amp; <span class="keyword">event</span>.target.blur();</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">// Global touchstart handler that creates an allowable region for a click event.</span></div>
<div class="line">  <span class="comment">// This allowable region can be removed by preventGhostClick if we want to bust it.</span></div>
<div class="line">  <span class="keyword">function</span> onTouchStart(event) {</div>
<div class="line">    var touches = <span class="keyword">event</span>.touches &amp;&amp; <span class="keyword">event</span>.touches.length ? <span class="keyword">event</span>.touches : [event];</div>
<div class="line">    var x = touches[0].clientX;</div>
<div class="line">    var y = touches[0].clientY;</div>
<div class="line">    touchCoordinates.push(x, y);</div>
<div class="line"></div>
<div class="line">    $timeout(<span class="keyword">function</span>() {</div>
<div class="line">      <span class="comment">// Remove the allowable region.</span></div>
<div class="line">      <span class="keywordflow">for</span> (var i = 0; i &lt; touchCoordinates.length; i += 2) {</div>
<div class="line">        <span class="keywordflow">if</span> (touchCoordinates[i] == x &amp;&amp; touchCoordinates[i + 1] == y) {</div>
<div class="line">          touchCoordinates.splice(i, i + 2);</div>
<div class="line">          <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">    }, PREVENT_DURATION, <span class="keyword">false</span>);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">// On the first call, attaches some event handlers. Then whenever it gets called, it creates a</span></div>
<div class="line">  <span class="comment">// zone around the touchstart where clicks will get busted.</span></div>
<div class="line">  <span class="keyword">function</span> preventGhostClick(x, y) {</div>
<div class="line">    <span class="keywordflow">if</span> (!touchCoordinates) {</div>
<div class="line">      $rootElement[0].addEventListener(<span class="stringliteral">&#39;click&#39;</span>, onClick, <span class="keyword">true</span>);</div>
<div class="line">      $rootElement[0].addEventListener(<span class="stringliteral">&#39;touchstart&#39;</span>, onTouchStart, <span class="keyword">true</span>);</div>
<div class="line">      touchCoordinates = [];</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    lastPreventedTime = Date.now();</div>
<div class="line"></div>
<div class="line">    checkAllowableRegions(touchCoordinates, x, y);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Actual linking function.</span></div>
<div class="line">  <span class="keywordflow">return</span> <span class="keyword">function</span>(scope, element, attr) {</div>
<div class="line">    var clickHandler = $parse(attr.ngClick),</div>
<div class="line">        tapping = <span class="keyword">false</span>,</div>
<div class="line">        tapElement,  <span class="comment">// Used to blur the element after a tap.</span></div>
<div class="line">        startTime,   <span class="comment">// Used to check if the tap was held too long.</span></div>
<div class="line">        touchStartX,</div>
<div class="line">        touchStartY;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">function</span> resetState() {</div>
<div class="line">      tapping = <span class="keyword">false</span>;</div>
<div class="line">      element.removeClass(ACTIVE_CLASS_NAME);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    element.on(<span class="stringliteral">&#39;touchstart&#39;</span>, <span class="keyword">function</span>(event) {</div>
<div class="line">      tapping = <span class="keyword">true</span>;</div>
<div class="line">      tapElement = <span class="keyword">event</span>.target ? <span class="keyword">event</span>.target : <span class="keyword">event</span>.srcElement; <span class="comment">// IE uses srcElement.</span></div>
<div class="line">      <span class="comment">// Hack for Safari, which can target text nodes instead of containers.</span></div>
<div class="line">      <span class="keywordflow">if</span> (tapElement.nodeType == 3) {</div>
<div class="line">        tapElement = tapElement.parentNode;</div>
<div class="line">      }</div>
<div class="line"></div>
<div class="line">      element.addClass(ACTIVE_CLASS_NAME);</div>
<div class="line"></div>
<div class="line">      startTime = Date.now();</div>
<div class="line"></div>
<div class="line">      <span class="comment">// Use jQuery originalEvent</span></div>
<div class="line">      var originalEvent = <span class="keyword">event</span>.originalEvent || event;</div>
<div class="line">      var touches = originalEvent.touches &amp;&amp; originalEvent.touches.length ? originalEvent.touches : [originalEvent];</div>
<div class="line">      var e = touches[0];</div>
<div class="line">      touchStartX = e.clientX;</div>
<div class="line">      touchStartY = e.clientY;</div>
<div class="line">    });</div>
<div class="line"></div>
<div class="line">    element.on(<span class="stringliteral">&#39;touchcancel&#39;</span>, <span class="keyword">function</span>(event) {</div>
<div class="line">      resetState();</div>
<div class="line">    });</div>
<div class="line"></div>
<div class="line">    element.on(<span class="stringliteral">&#39;touchend&#39;</span>, <span class="keyword">function</span>(event) {</div>
<div class="line">      var diff = Date.now() - startTime;</div>
<div class="line"></div>
<div class="line">      <span class="comment">// Use jQuery originalEvent</span></div>
<div class="line">      var originalEvent = <span class="keyword">event</span>.originalEvent || event;</div>
<div class="line">      var touches = (originalEvent.changedTouches &amp;&amp; originalEvent.changedTouches.length) ?</div>
<div class="line">          originalEvent.changedTouches :</div>
<div class="line">          ((originalEvent.touches &amp;&amp; originalEvent.touches.length) ? originalEvent.touches : [originalEvent]);</div>
<div class="line">      var e = touches[0];</div>
<div class="line">      var x = e.clientX;</div>
<div class="line">      var y = e.clientY;</div>
<div class="line">      var dist = Math.sqrt(Math.pow(x - touchStartX, 2) + Math.pow(y - touchStartY, 2));</div>
<div class="line"></div>
<div class="line">      <span class="keywordflow">if</span> (tapping &amp;&amp; diff &lt; TAP_DURATION &amp;&amp; dist &lt; MOVE_TOLERANCE) {</div>
<div class="line">        <span class="comment">// Call preventGhostClick so the clickbuster will catch the corresponding click.</span></div>
<div class="line">        preventGhostClick(x, y);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Blur the focused element (the button, probably) before firing the callback.</span></div>
<div class="line">        <span class="comment">// This doesn&#39;t work perfectly on Android Chrome, but seems to work elsewhere.</span></div>
<div class="line">        <span class="comment">// I couldn&#39;t get anything to work reliably on Android Chrome.</span></div>
<div class="line">        <span class="keywordflow">if</span> (tapElement) {</div>
<div class="line">          tapElement.blur();</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (!angular.isDefined(attr.disabled) || attr.disabled === <span class="keyword">false</span>) {</div>
<div class="line">          element.triggerHandler(<span class="stringliteral">&#39;click&#39;</span>, [event]);</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line"></div>
<div class="line">      resetState();</div>
<div class="line">    });</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Hack for iOS Safari&#39;s benefit. It goes searching for onclick handlers and is liable to click</span></div>
<div class="line">    <span class="comment">// something else nearby.</span></div>
<div class="line">    element.onclick = <span class="keyword">function</span>(event) { };</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Actual click handler.</span></div>
<div class="line">    <span class="comment">// There are three different kinds of clicks, only two of which reach this point.</span></div>
<div class="line">    <span class="comment">// - On desktop browsers without touch events, their clicks will always come here.</span></div>
<div class="line">    <span class="comment">// - On mobile browsers, the simulated &quot;fast&quot; click will call this.</span></div>
<div class="line">    <span class="comment">// - But the browser&#39;s follow-up slow click will be &quot;busted&quot; before it reaches this handler.</span></div>
<div class="line">    <span class="comment">// Therefore it&#39;s safe to use this directive on both mobile and desktop.</span></div>
<div class="line">    element.on(<span class="stringliteral">&#39;click&#39;</span>, <span class="keyword">function</span>(event, touchend) {</div>
<div class="line">      scope.$apply(<span class="keyword">function</span>() {</div>
<div class="line">        clickHandler(scope, {$event: (touchend || event)});</div>
<div class="line">      });</div>
<div class="line">    });</div>
<div class="line"></div>
<div class="line">    element.on(<span class="stringliteral">&#39;mousedown&#39;</span>, <span class="keyword">function</span>(event) {</div>
<div class="line">      element.addClass(ACTIVE_CLASS_NAME);</div>
<div class="line">    });</div>
<div class="line"></div>
<div class="line">    element.on(<span class="stringliteral">&#39;mousemove mouseup&#39;</span>, <span class="keyword">function</span>(event) {</div>
<div class="line">      element.removeClass(ACTIVE_CLASS_NAME);</div>
<div class="line">    });</div>
<div class="line"></div>
<div class="line">  };</div>
<div class="line">}]);</div>
<div class="line"></div>
<div class="line"><span class="comment">/* global ngTouch: false */</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">function</span> makeSwipeDirective(directiveName, direction, eventName) {</div>
<div class="line">  ngTouch.directive(directiveName, [<span class="stringliteral">&#39;$parse&#39;</span>, <span class="stringliteral">&#39;$swipe&#39;</span>, <span class="keyword">function</span>($parse, $swipe) {</div>
<div class="line">    <span class="comment">// The maximum vertical delta for a swipe should be less than 75px.</span></div>
<div class="line">    var MAX_VERTICAL_DISTANCE = 75;</div>
<div class="line">    <span class="comment">// Vertical distance should not be more than a fraction of the horizontal distance.</span></div>
<div class="line">    var MAX_VERTICAL_RATIO = 0.3;</div>
<div class="line">    <span class="comment">// At least a 30px lateral motion is necessary for a swipe.</span></div>
<div class="line">    var MIN_HORIZONTAL_DISTANCE = 30;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">function</span>(scope, element, attr) {</div>
<div class="line">      var swipeHandler = $parse(attr[directiveName]);</div>
<div class="line"></div>
<div class="line">      var startCoords, valid;</div>
<div class="line"></div>
<div class="line">      <span class="keyword">function</span> validSwipe(coords) {</div>
<div class="line">        <span class="comment">// Check that it&#39;s within the coordinates.</span></div>
<div class="line">        <span class="comment">// Absolute vertical distance must be within tolerances.</span></div>
<div class="line">        <span class="comment">// Horizontal distance, we take the current X - the starting X.</span></div>
<div class="line">        <span class="comment">// This is negative for leftward swipes and positive for rightward swipes.</span></div>
<div class="line">        <span class="comment">// After multiplying by the direction (-1 for left, +1 for right), legal swipes</span></div>
<div class="line">        <span class="comment">// (ie. same direction as the directive wants) will have a positive delta and</span></div>
<div class="line">        <span class="comment">// illegal ones a negative delta.</span></div>
<div class="line">        <span class="comment">// Therefore this delta must be positive, and larger than the minimum.</span></div>
<div class="line">        <span class="keywordflow">if</span> (!startCoords) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">        var deltaY = Math.abs(coords.y - startCoords.y);</div>
<div class="line">        var deltaX = (coords.x - startCoords.x) * direction;</div>
<div class="line">        <span class="keywordflow">return</span> valid &amp;&amp; <span class="comment">// Short circuit for already-invalidated swipes.</span></div>
<div class="line">            deltaY &lt; MAX_VERTICAL_DISTANCE &amp;&amp;</div>
<div class="line">            deltaX &gt; 0 &amp;&amp;</div>
<div class="line">            deltaX &gt; MIN_HORIZONTAL_DISTANCE &amp;&amp;</div>
<div class="line">            deltaY / deltaX &lt; MAX_VERTICAL_RATIO;</div>
<div class="line">      }</div>
<div class="line"></div>
<div class="line">      var pointerTypes = [<span class="stringliteral">&#39;touch&#39;</span>];</div>
<div class="line">      <span class="keywordflow">if</span> (!angular.isDefined(attr[<span class="stringliteral">&#39;ngSwipeDisableMouse&#39;</span>])) {</div>
<div class="line">        pointerTypes.push(<span class="stringliteral">&#39;mouse&#39;</span>);</div>
<div class="line">      }</div>
<div class="line">      $swipe.bind(element, {</div>
<div class="line">        <span class="stringliteral">&#39;start&#39;</span>: <span class="keyword">function</span>(coords, event) {</div>
<div class="line">          startCoords = coords;</div>
<div class="line">          valid = <span class="keyword">true</span>;</div>
<div class="line">        },</div>
<div class="line">        <span class="stringliteral">&#39;cancel&#39;</span>: <span class="keyword">function</span>(event) {</div>
<div class="line">          valid = <span class="keyword">false</span>;</div>
<div class="line">        },</div>
<div class="line">        <span class="stringliteral">&#39;end&#39;</span>: <span class="keyword">function</span>(coords, event) {</div>
<div class="line">          <span class="keywordflow">if</span> (validSwipe(coords)) {</div>
<div class="line">            scope.$apply(<span class="keyword">function</span>() {</div>
<div class="line">              element.triggerHandler(eventName);</div>
<div class="line">              swipeHandler(scope, {$event: <span class="keyword">event</span>});</div>
<div class="line">            });</div>
<div class="line">          }</div>
<div class="line">        }</div>
<div class="line">      }, pointerTypes);</div>
<div class="line">    };</div>
<div class="line">  }]);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">// Left is negative X-coordinate, right is positive.</span></div>
<div class="line">makeSwipeDirective(<span class="stringliteral">&#39;ngSwipeLeft&#39;</span>, -1, <span class="stringliteral">&#39;swipeleft&#39;</span>);</div>
<div class="line">makeSwipeDirective(<span class="stringliteral">&#39;ngSwipeRight&#39;</span>, 1, <span class="stringliteral">&#39;swiperight&#39;</span>);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"></div>
<div class="line">})(window, window.angular);</div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.10
</small></address>
</body>
</html>
