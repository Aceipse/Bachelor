<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>WisR web applikation: Handlebars Compiler APIs</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">WisR web applikation
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Handlebars Compiler APIs </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>There are a number of formal APIs that tool implementors may interact with.</p>
<h2>AST</h2>
<p>Other tools may interact with the formal AST as defined below. Any JSON structure matching this pattern may be used and passed into the <code>compile</code> and <code>precompile</code> methods in the same way as the text for a template.</p>
<p>AST structures may be generated either with the <code>Handlebars.parse</code> method and then manipulated, via the <code>Handlebars.AST</code> objects of the same name, or constructed manually as a generic JavaScript object matching the structure defined below.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;var ast = Handlebars.parse(myTemplate);</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;// Modify ast</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;Handlebars.precompile(ast);</div>
</div><!-- fragment --><h3>Basic</h3>
<div class="fragment"><div class="line"><span class="keyword">interface </span>Node {</div>
<div class="line">    type: string;</div>
<div class="line">    loc: SourceLocation | null;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">interface </span>SourceLocation {</div>
<div class="line">    source: <span class="keywordtype">string</span> | null;</div>
<div class="line">    start: Position;</div>
<div class="line">    end: Position;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">interface </span>Position {</div>
<div class="line">    line: uint &gt;= 1;</div>
<div class="line">    column: uint &gt;= 0;</div>
<div class="line">}</div>
</div><!-- fragment --><h3>Programs</h3>
<div class="fragment"><div class="line"><span class="keyword">interface </span>Program &lt;: Node {</div>
<div class="line">    type: <span class="stringliteral">&quot;Program&quot;</span>;</div>
<div class="line">    body: [ Statement ];</div>
<div class="line"></div>
<div class="line">    blockParams: [ string ];</div>
<div class="line">}</div>
</div><!-- fragment --><h3>Statements</h3>
<div class="fragment"><div class="line"><span class="keyword">interface </span>Statement &lt;: Node { }</div>
<div class="line"></div>
<div class="line"><span class="keyword">interface </span>MustacheStatement &lt;: Statement {</div>
<div class="line">    type: <span class="stringliteral">&quot;MustacheStatement&quot;</span>;</div>
<div class="line"></div>
<div class="line">    path: PathExpression | Literal;</div>
<div class="line">    params: [ Expression ];</div>
<div class="line">    hash: Hash;</div>
<div class="line"></div>
<div class="line">    escaped: boolean;</div>
<div class="line">    strip: StripFlags | null;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">interface </span>BlockStatement &lt;: Statement {</div>
<div class="line">    type: <span class="stringliteral">&quot;BlockStatement&quot;</span>;</div>
<div class="line">    path: PathExpression;</div>
<div class="line">    params: [ Expression ];</div>
<div class="line">    hash: Hash;</div>
<div class="line"></div>
<div class="line">    program: Program | null;</div>
<div class="line">    inverse: Program | null;</div>
<div class="line"></div>
<div class="line">    openStrip: StripFlags | null;</div>
<div class="line">    inverseStrip: StripFlags | null;</div>
<div class="line">    closeStrip: StripFlags | null;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">interface </span>PartialStatement &lt;: Statement {</div>
<div class="line">    type: <span class="stringliteral">&quot;PartialStatement&quot;</span>;</div>
<div class="line">    name: PathExpression | SubExpression;</div>
<div class="line">    params: [ Expression ];</div>
<div class="line">    hash: Hash;</div>
<div class="line"></div>
<div class="line">    indent: string;</div>
<div class="line">    strip: StripFlags | null;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">interface </span>PartialBlockStatement &lt;: Statement {</div>
<div class="line">    type: <span class="stringliteral">&quot;PartialBlockStatement&quot;</span>;</div>
<div class="line">    name: PathExpression | SubExpression;</div>
<div class="line">    params: [ Expression ];</div>
<div class="line">    hash: Hash;</div>
<div class="line"></div>
<div class="line">    program: Program | null;</div>
<div class="line"></div>
<div class="line">    indent: string;</div>
<div class="line">    openStrip: StripFlags | null;</div>
<div class="line">    closeStrip: StripFlags | null;</div>
<div class="line">}</div>
</div><!-- fragment --><p><code>name</code> will be a <code>SubExpression</code> when tied to a dynamic partial, i.e. <code>{{&gt; (foo) }}</code>, otherwise this is a path or literal whose <code>original</code> value is used to lookup the desired partial.</p>
<div class="fragment"><div class="line"><span class="keyword">interface </span>ContentStatement &lt;: Statement {</div>
<div class="line">    type: <span class="stringliteral">&quot;ContentStatement&quot;</span>;</div>
<div class="line">    value: string;</div>
<div class="line">    original: string;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">interface </span>CommentStatement &lt;: Statement {</div>
<div class="line">    type: <span class="stringliteral">&quot;CommentStatement&quot;</span>;</div>
<div class="line">    value: string;</div>
<div class="line"></div>
<div class="line">    strip: StripFlags | null;</div>
<div class="line">}</div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="keyword">interface </span>Decorator &lt;: Statement {</div>
<div class="line">    type: <span class="stringliteral">&quot;Decorator&quot;</span>;</div>
<div class="line"></div>
<div class="line">    path: PathExpression | Literal;</div>
<div class="line">    params: [ Expression ];</div>
<div class="line">    hash: Hash;</div>
<div class="line"></div>
<div class="line">    strip: StripFlags | null;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">interface </span>DecoratorBlock &lt;: Statement {</div>
<div class="line">    type: <span class="stringliteral">&quot;DecoratorBlock&quot;</span>;</div>
<div class="line">    path: PathExpression | Literal;</div>
<div class="line">    params: [ Expression ];</div>
<div class="line">    hash: Hash;</div>
<div class="line"></div>
<div class="line">    program: Program | null;</div>
<div class="line"></div>
<div class="line">    openStrip: StripFlags | null;</div>
<div class="line">    closeStrip: StripFlags | null;</div>
<div class="line">}</div>
</div><!-- fragment --><p>Decorator paths only utilize the <code>path.original</code> value and as a consequence do not support depthed evaluation.</p>
<h3>Expressions</h3>
<div class="fragment"><div class="line"><span class="keyword">interface </span>Expression &lt;: Node { }</div>
</div><!-- fragment --><h5>SubExpressions</h5>
<div class="fragment"><div class="line"><span class="keyword">interface </span>SubExpression &lt;: Expression {</div>
<div class="line">    type: <span class="stringliteral">&quot;SubExpression&quot;</span>;</div>
<div class="line">    path: PathExpression;</div>
<div class="line">    params: [ Expression ];</div>
<div class="line">    hash: Hash;</div>
<div class="line">}</div>
</div><!-- fragment --><h5>Paths</h5>
<div class="fragment"><div class="line"><span class="keyword">interface </span>PathExpression &lt;: Expression {</div>
<div class="line">    type: <span class="stringliteral">&quot;PathExpression&quot;</span>;</div>
<div class="line">    data: boolean;</div>
<div class="line">    depth: uint &gt;= 0;</div>
<div class="line">    parts: [ string ];</div>
<div class="line">    original: string;</div>
<div class="line">}</div>
</div><!-- fragment --><ul>
<li><code>data</code> is true when the given expression is a <code>@data</code> reference.</li>
<li><code>depth</code> is an integer representation of which context the expression references. <code>0</code> represents the current context, <code>1</code> would be <code>../</code>, etc.</li>
<li><code>parts</code> is an array of the names in the path. <code>foo.bar</code> would be `['foo', 'bar']<code>. Scope references,</code>.<code>,</code>..<code>, and</code>this<code>should be omitted from this array. -</code>original` is the path as entered by the user. Separator and scope references are left untouched.</li>
</ul>
<h5>Literals</h5>
<div class="fragment"><div class="line"><span class="keyword">interface </span>Literal &lt;: Expression { }</div>
<div class="line"></div>
<div class="line"><span class="keyword">interface </span>StringLiteral &lt;: Literal {</div>
<div class="line">    type: <span class="stringliteral">&quot;StringLiteral&quot;</span>;</div>
<div class="line">    value: string;</div>
<div class="line">    original: string;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">interface </span>BooleanLiteral &lt;: Literal {</div>
<div class="line">    type: <span class="stringliteral">&quot;BooleanLiteral&quot;</span>;</div>
<div class="line">    value: boolean;</div>
<div class="line">    original: boolean;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">interface </span>NumberLiteral &lt;: Literal {</div>
<div class="line">    type: <span class="stringliteral">&quot;NumberLiteral&quot;</span>;</div>
<div class="line">    value: number;</div>
<div class="line">    original: number;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">interface </span>UndefinedLiteral &lt;: Literal {</div>
<div class="line">    type: <span class="stringliteral">&quot;UndefinedLiteral&quot;</span>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">interface </span>NullLiteral &lt;: Literal {</div>
<div class="line">    type: <span class="stringliteral">&quot;NullLiteral&quot;</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><h3>Miscellaneous</h3>
<div class="fragment"><div class="line"><span class="keyword">interface </span>Hash &lt;: Node {</div>
<div class="line">    type: <span class="stringliteral">&quot;Hash&quot;</span>;</div>
<div class="line">    pairs: [ HashPair ];</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">interface </span>HashPair &lt;: Node {</div>
<div class="line">    type: <span class="stringliteral">&quot;HashPair&quot;</span>;</div>
<div class="line">    key: string;</div>
<div class="line">    value: Expression;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">interface </span>StripFlags {</div>
<div class="line">    open: boolean;</div>
<div class="line">    close: boolean;</div>
<div class="line">}</div>
</div><!-- fragment --><p><code>StripFlags</code> are used to signify whitespace control character that may have been entered on a given statement.</p>
<h2>AST Visitor</h2>
<p><code>Handlebars.Visitor</code> is available as a base class for general interaction with AST structures. This will by default traverse the entire tree and individual methods may be overridden to provide specific responses to particular nodes.</p>
<p>Recording all referenced partial names:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;var Visitor = Handlebars.Visitor;</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;function ImportScanner() {</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  this.partials = [];</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;}</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;ImportScanner.prototype = new Visitor();</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;ImportScanner.prototype.PartialStatement = function(partial) {</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;  this.partials.push({request: partial.name.original});</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;  Visitor.prototype.PartialStatement.call(this, partial);</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;};</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;var scanner = new ImportScanner();</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;scanner.accept(ast);</div>
</div><!-- fragment --><p>The current node's ancestors will be maintained in the <code>parents</code> array, with the most recent parent listed first.</p>
<p>The visitor may also be configured to operate in mutation mode by setting the <code>mutation</code> field to true. When in this mode, handler methods may return any valid AST node and it will replace the one they are currently operating on. Returning <code>false</code> will remove the given value (if valid) and returning <code>undefined</code> will leave the node in tact. This return structure only apply to mutation mode and non-mutation mode visitors are free to return whatever values they wish.</p>
<p>Implementors that may need to support mutation mode are encouraged to utilize the <code>acceptKey</code>, <code>acceptRequired</code> and <code>acceptArray</code> helpers which provide the conditional overwrite behavior as well as implement sanity checks where pertinent.</p>
<h2>JavaScript Compiler</h2>
<p>The <code>Handlebars.JavaScriptCompiler</code> object has a number of methods that may be customized to alter the output of the compiler:</p>
<ul>
<li><p class="startli"><code>nameLookup(parent, name, type)</code> Used to generate the code to resolve a give path component.</p><ul>
<li><code>parent</code> is the existing code in the path resolution</li>
<li><code>name</code> is the current path component</li>
<li><code>type</code> is the type of name being evaluated. May be one of <code>context</code>, <code>data</code>, <code>helper</code>, <code>decorator</code>, or <code>partial</code>.</li>
</ul>
<p class="startli">Note that this does not impact dynamic partials, which implementors need to be aware of. Overriding <code>VM.resolvePartial</code> may be required to support dynamic cases.</p>
</li>
<li><code>depthedLookup(name)</code> Used to generate code that resolves parameters within any context in the stack. Is only used in <code>compat</code> mode.</li>
<li><code>compilerInfo()</code> Allows for custom compiler flags used in the runtime version checking logic.</li>
<li><code>appendToBuffer(source, location, explicit)</code> Allows for code buffer emitting code. Defaults behavior is string concatenation.<ul>
<li><code>source</code> is the source code whose result is to be appending</li>
<li><code>location</code> is the location of the source in the source map.</li>
<li><code>explicit</code> is a flag signaling that the emit operation must occur, vs. the lazy evaled options otherwise.</li>
</ul>
</li>
<li><code>initializeBuffer()</code> Allows for buffers other than the default string buffer to be used. Generally needs to be paired with a custom <code>appendToBuffer</code> implementation.</li>
</ul>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;function MyCompiler() {</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  Handlebars.JavaScriptCompiler.apply(this, arguments);</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;}</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;MyCompiler.prototype = Object.create(Handlebars.JavaScriptCompiler);</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;MyCompiler.nameLookup = function(parent, name, type) {</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;  if (type === &#39;partial&#39;) {</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    return &#39;MyPartialList[&#39; + JSON.stringify(name) &#39;]&#39;;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;  } else {</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;    return Handlebars.JavaScriptCompiler.prototype.nameLookup.call(this, parent, name, type);</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;  }</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;};</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;var env = Handlebars.create();</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;env.JavaScriptCompiler = MyCompiler;</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;env.compile(&#39;my template&#39;);</div>
</div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.10
</small></address>
</body>
</html>
