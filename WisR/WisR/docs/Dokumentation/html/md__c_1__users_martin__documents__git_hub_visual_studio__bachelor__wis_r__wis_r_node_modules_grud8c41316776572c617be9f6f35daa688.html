<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>WisR web applikation: nue — An async control-flow library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">WisR web applikation
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">nue — An async control-flow library </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>nue is an async control-flow library suited for node.js.</p>
<h2>Installing</h2>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ npm install nue</div>
</div><!-- fragment --><h2>Example</h2>
<div class="fragment"><div class="line">var flow = require(<span class="stringliteral">&#39;nue&#39;</span>).flow;</div>
<div class="line">var as = require(<span class="stringliteral">&#39;nue&#39;</span>).as;</div>
<div class="line">var fs = require(<span class="stringliteral">&#39;fs&#39;</span>);</div>
<div class="line"></div>
<div class="line">var myFlow = flow(<span class="stringliteral">&#39;myFlow&#39;</span>)(</div>
<div class="line">  <span class="keyword">function</span> readFiles(file1, file2) {</div>
<div class="line">    fs.readFile(file1, <span class="stringliteral">&#39;utf8&#39;</span>, this.async(as(1)));</div>
<div class="line">    fs.readFile(file2, <span class="stringliteral">&#39;utf8&#39;</span>, this.async(as(1)));</div>
<div class="line">  },</div>
<div class="line">  <span class="keyword">function</span> concat(data1, data2) {</div>
<div class="line">    this.next(data1 + data2);</div>
<div class="line">  },</div>
<div class="line">  <span class="keyword">function</span> end(data) {</div>
<div class="line">    <span class="keywordflow">if</span> (this.err) <span class="keywordflow">throw</span> this.err;</div>
<div class="line">    console.log(data);</div>
<div class="line">    console.log(<span class="stringliteral">&#39;done&#39;</span>);</div>
<div class="line">    this.next();</div>
<div class="line">  }</div>
<div class="line">);</div>
<div class="line"></div>
<div class="line">myFlow(<span class="stringliteral">&#39;file1&#39;</span>, <span class="stringliteral">&#39;file2&#39;</span>);</div>
</div><!-- fragment --><h2>API</h2>
<h3>Top Level API</h3>
<p>The <code>nue</code> module provides following API.</p>
<h4>flow([Function steps...]) -&gt; Function</h4>
<p>Return a function which represents the control-flow.</p>
<ul>
<li><code>steps</code>: Optional. Optional functions to execute in series.</li>
</ul>
<h4>flow(String flowName) -&gt; Function</h4>
<p>Accept a flow name and return another <code>flow</code> function.</p>
<ul>
<li><code>flowName</code>: Required. A flow name to be used for debug.</li>
</ul>
<h4>parallel([Function steps...]) -&gt; Function</h4>
<p>Return a function which represents the parallel control-flow. The <code>parallel</code> must be nested inside a <code>flow</code> or another <code>parallel</code>.</p>
<ul>
<li><code>steps</code>: Optional. Optional functions to execute in parallel.</li>
</ul>
<h4>parallel(String flowName) -&gt; Function</h4>
<p>Accept a flow name and return another <code>parallel</code> function.</p>
<ul>
<li><code>flowName</code>: Required. A flow name to be used for debug.</li>
</ul>
<h4>as(Number index) -&gt; Object</h4>
<ul>
<li><code>index</code>: Required. An index to map an asynchronous callback argument to a next step argument. If the index is zero, an error handling is skipped.</li>
</ul>
<h3>Step Context API</h3>
<p><code>flow</code> and <code>parallel</code> API accept functions called <code>step</code>s. Each step context object - it means a <code>this</code> object in the step function - provides following API.</p>
<h4>next([Object values...]) -&gt; Void</h4>
<p>A function to execute a next step immediately.</p>
<ul>
<li><code>values</code>: Optional. Arguments for a next step.</li>
</ul>
<h4>async([Object mapping]) -&gt; Function</h4>
<p>A function to accept an argument mapping definition for a next step and return a callback. <code>async</code> can be called many times, but all calls are done in same tick. And all callbacks <code>async</code> returns must be called.</p>
<ul>
<li><code>mapping</code>: Optional. An argument mapping definition.</li>
</ul>
<p>To map single argument, call <code>as</code> API and pass its result.</p>
<div class="fragment"><div class="line">fs.readFile(<span class="stringliteral">&#39;file1&#39;</span>, <span class="stringliteral">&#39;utf8&#39;</span>, this.async(as(1)));</div>
</div><!-- fragment --><p>To map multiple arguments, pass an object.</p>
<div class="fragment"><div class="line">child_process.exec(<span class="stringliteral">&#39;whoami&#39;</span>, this.async({stdout: as(1), stderr: as(2)}));</div>
</div><!-- fragment --><p>To map multiple arguments except first one, pass no object. You can get result arguments by index.</p>
<div class="fragment"><div class="line">child_process.exec(<span class="stringliteral">&#39;whoami&#39;</span>, this.async());</div>
</div><!-- fragment --><h4>asyncEach(Array array, Function callback(element, group, index, traversedArray)) -&gt; Void</h4>
<p>A function to execute a provided function once per array element asynchronously.</p>
<ul>
<li><code>array</code>: Required. An array.</li>
<li><code>callback</code>: Required. A function being executed once per array element. The context object in the callback is same with outer step context object.</li>
<li><code>element</code>: Required. A current element.</li>
<li><code>group</code>: Required. Provedes <code>async</code> function to accept an argument mapping definition and return a callback.</li>
<li><code>index</code>: Required. An element index.</li>
<li><code>traversedArray</code>: Required. An array object being traversed.</li>
</ul>
<h4>asyncEach(Number concurrency) -&gt; Function</h4>
<p>A function to accept a concurrency number and return another <code>asyncEach</code> function which executes a provided function once per array element asynchronously with the specified cuncurrency. If you use another <code>asyncEach</code> function directly, default concurrency 10 is used.</p>
<ul>
<li><code>concurrency</code>: Required. the number of concurrency.</li>
</ul>
<h4>exec(Function function, [Object args...], Function callback(err, [values...])) -&gt; Void</h4>
<p>A function to execute a specified <code>function</code> with <code>args</code> asynchronously.</p>
<ul>
<li><code>function</code>: Required. A function to be executed asynchronously.</li>
<li><code>args</code>: Optional. Arguments for the <code>function</code>.</li>
<li><code>callback</code>: Required. A function to be executed when the <code>function</code> is completed.</li>
<li><code>err</code>: Required. An error in an async call.</li>
<li><code>values</code>: Required. Results from the <code>function</code>.</li>
</ul>
<h4>end([Object values...]) -&gt; Void</h4>
<p>A function to execute a last step immediately to end a control-flow.</p>
<ul>
<li><code>values</code>: Optional. Arguments for a last step.</li>
</ul>
<h4>endWith(Error err) -&gt; Void</h4>
<p>A function to execute a last step immediately with an error to end a control-flow.</p>
<ul>
<li><code>err</code>: Required. An error object. This object can be referred as <code>this.err</code> in a last step.</li>
</ul>
<h4>data : Object</h4>
<p>A object to share arbitrary data between steps in a control-flow.</p>
<h4>flowName : String</h4>
<p>A flow name.</p>
<h4>stepName : String</h4>
<p>A step name.</p>
<h4>err : Object</h4>
<p>An error object, which is thrown with <code>throw</code>, passed to <code>this.endWith</code> or passed to an async callback as first argument. This property is accessible in only last steps.</p>
<h2>More Examples</h2>
<h3>Arguments Passing Between Functions</h3>
<p>Arguments are passed with <code>this.next</code> or <code>this.async</code>.</p>
<h4>Synchronously</h4>
<div class="fragment"><div class="line">var flow = require(<span class="stringliteral">&#39;nue&#39;</span>).flow;</div>
<div class="line"></div>
<div class="line">var myFlow = flow(<span class="stringliteral">&#39;myFlow&#39;</span>)(</div>
<div class="line">  <span class="keyword">function</span> concat(s1, s2) {</div>
<div class="line">    var length = s1.length + s2.length</div>
<div class="line">    this.next(s1, s2, length);</div>
<div class="line">  },</div>
<div class="line">  <span class="keyword">function</span> end(s1, s2, length) {</div>
<div class="line">    <span class="keywordflow">if</span> (this.err) <span class="keywordflow">throw</span> this.err;</div>
<div class="line">    console.log(s1 + <span class="stringliteral">&#39;.length + &#39;</span> + s2 + <span class="stringliteral">&#39;.length -&gt; &#39;</span> + length); <span class="comment">// file1.length + file2.length -&gt; 10</span></div>
<div class="line">    console.log(<span class="stringliteral">&#39;done&#39;</span>);</div>
<div class="line">    this.next();</div>
<div class="line">  }</div>
<div class="line">);</div>
<div class="line"></div>
<div class="line">myFlow(<span class="stringliteral">&#39;file1&#39;</span>, <span class="stringliteral">&#39;file2&#39;</span>);</div>
</div><!-- fragment --><h4>Asynchronously</h4>
<p>To pass asynchronous call results to a next function, arguments mapping definition is necessary. The function <code>as</code> accepts an index to specify a callback argument and returns arguments mapping definition. The function <code>this.async</code> accepts the mapping definition and return a callback. When all callbacks are completed, the next function is called with specific arguments.</p>
<div class="fragment"><div class="line">var flow = require(<span class="stringliteral">&#39;nue&#39;</span>).flow;</div>
<div class="line">var as = require(<span class="stringliteral">&#39;nue&#39;</span>).as;</div>
<div class="line">var fs = require(<span class="stringliteral">&#39;fs&#39;</span>);</div>
<div class="line"></div>
<div class="line">var myFlow = flow(<span class="stringliteral">&#39;myFlow&#39;</span>)(</div>
<div class="line">  <span class="keyword">function</span> readFiles(file1, file2) {</div>
<div class="line">    fs.readFile(file1, <span class="stringliteral">&#39;utf8&#39;</span>, this.async(as(1)));</div>
<div class="line">    fs.readFile(file2, <span class="stringliteral">&#39;utf8&#39;</span>, this.async(as(1)));</div>
<div class="line">  },</div>
<div class="line">  <span class="keyword">function</span> end(data1, data2) {</div>
<div class="line">    <span class="keywordflow">if</span> (this.err) <span class="keywordflow">throw</span> this.err;</div>
<div class="line">    console.log(data1 + data2); <span class="comment">// FILE1FILE2</span></div>
<div class="line">    console.log(<span class="stringliteral">&#39;done&#39;</span>);</div>
<div class="line">    this.next();</div>
<div class="line">  }</div>
<div class="line">);</div>
<div class="line"></div>
<div class="line">myFlow(<span class="stringliteral">&#39;file1&#39;</span>, <span class="stringliteral">&#39;file2&#39;</span>);</div>
</div><!-- fragment --><p>Arguments mapping definition can contain arbitrary values.</p>
<div class="fragment"><div class="line">var flow = require(<span class="stringliteral">&#39;nue&#39;</span>).flow;</div>
<div class="line">var as = require(<span class="stringliteral">&#39;nue&#39;</span>).as;</div>
<div class="line">var fs = require(<span class="stringliteral">&#39;fs&#39;</span>);</div>
<div class="line"></div>
<div class="line">var myFlow = flow(<span class="stringliteral">&#39;myFlow&#39;</span>)(</div>
<div class="line">  <span class="keyword">function</span> readFiles(file1, file2) {</div>
<div class="line">    fs.readFile(file1, <span class="stringliteral">&#39;utf8&#39;</span>, this.async({name: file1, data: as(1)}));</div>
<div class="line">    fs.readFile(file2, <span class="stringliteral">&#39;utf8&#39;</span>, this.async({name: file2, data: as(1)}));</div>
<div class="line">  },</div>
<div class="line">  <span class="keyword">function</span> end(f1, f2) {</div>
<div class="line">    <span class="keywordflow">if</span> (this.err) <span class="keywordflow">throw</span> this.err;</div>
<div class="line">    console.log(f1.name + <span class="stringliteral">&#39; and &#39;</span> + f2.name + <span class="stringliteral">&#39; have been read.&#39;</span>); <span class="comment">// file1 and file2 have been read.</span></div>
<div class="line">    console.log(f1.data + f2.data); <span class="comment">// FILE1FILE2</span></div>
<div class="line">    console.log(<span class="stringliteral">&#39;done&#39;</span>);</div>
<div class="line">    this.next();</div>
<div class="line">  }</div>
<div class="line">);</div>
<div class="line"></div>
<div class="line">myFlow(<span class="stringliteral">&#39;file1&#39;</span>, <span class="stringliteral">&#39;file2&#39;</span>);</div>
</div><!-- fragment --><h3>Asynchronous Loop</h3>
<p><code>this.asyncEach</code> executes a provided function once per array element asynchronously. By default, the number of concurrency is 10.</p>
<div class="fragment"><div class="line">var flow = require(<span class="stringliteral">&#39;nue&#39;</span>).flow;</div>
<div class="line">var as = require(<span class="stringliteral">&#39;nue&#39;</span>).as;</div>
<div class="line">var fs = require(<span class="stringliteral">&#39;fs&#39;</span>);</div>
<div class="line"></div>
<div class="line">var myFlow = flow(<span class="stringliteral">&#39;myFlow&#39;</span>)(</div>
<div class="line">  <span class="keyword">function</span> readFiles(files) {</div>
<div class="line">    this.asyncEach(files, <span class="keyword">function</span> (file, group) {</div>
<div class="line">      fs.readFile(file, <span class="stringliteral">&#39;utf8&#39;</span>, group.async({name: file, data: as(1)}));</div>
<div class="line">    });</div>
<div class="line">  },</div>
<div class="line">  <span class="keyword">function</span> end(files) {</div>
<div class="line">    <span class="keywordflow">if</span> (this.err) <span class="keywordflow">throw</span> this.err;</div>
<div class="line">    var names = files.map(<span class="keyword">function</span> (f) { <span class="keywordflow">return</span> f.name; });</div>
<div class="line">    var contents = files.map(<span class="keyword">function</span> (f) { <span class="keywordflow">return</span> f.data});</div>
<div class="line">    console.log(names.join(<span class="stringliteral">&#39; and &#39;</span>) + <span class="stringliteral">&#39; have been read.&#39;</span>); <span class="comment">// file1 and file2 have been read.</span></div>
<div class="line">    console.log(contents.join(<span class="stringliteral">&#39;&#39;</span>)); <span class="comment">// FILE1FILE2</span></div>
<div class="line">    this.next();</div>
<div class="line">  }</div>
<div class="line">);</div>
<div class="line"></div>
<div class="line">myFlow([<span class="stringliteral">&#39;file1&#39;</span>, <span class="stringliteral">&#39;file2&#39;</span>]);</div>
</div><!-- fragment --><p>To change the number of concurrency, specify the number as below.</p>
<div class="fragment"><div class="line"><span class="keyword">function</span> readFiles(files) {</div>
<div class="line">  this.asyncEach(5)(files, <span class="keyword">function</span> (file, group) {</div>
<div class="line">     ...</div>
<div class="line">  });</div>
<div class="line">},</div>
</div><!-- fragment --><h3>Flow Nesting</h3>
<p>A flow is composable. So it can be nested.</p>
<div class="fragment"><div class="line">var flow = require(<span class="stringliteral">&#39;nue&#39;</span>).flow;</div>
<div class="line">var as = require(<span class="stringliteral">&#39;nue&#39;</span>).as;</div>
<div class="line">var fs = require(<span class="stringliteral">&#39;fs&#39;</span>);</div>
<div class="line"></div>
<div class="line">var subFlow = flow(<span class="stringliteral">&#39;subFlow&#39;</span>)(</div>
<div class="line">  <span class="keyword">function</span> readFile(file) {</div>
<div class="line">    fs.readFile(file, <span class="stringliteral">&#39;utf8&#39;</span>, this.async(as(1)));</div>
<div class="line">  }</div>
<div class="line">);</div>
<div class="line"></div>
<div class="line">var mainFlow = flow(<span class="stringliteral">&#39;mainFlow&#39;</span>)(</div>
<div class="line">  <span class="keyword">function</span> start() {</div>
<div class="line">    this.next(<span class="stringliteral">&#39;file1&#39;</span>);</div>
<div class="line">  },</div>
<div class="line">  subFlow,</div>
<div class="line">  <span class="keyword">function</span> end(result) {</div>
<div class="line">    <span class="keywordflow">if</span> (this.err) <span class="keywordflow">throw</span> this.err;</div>
<div class="line">    console.log(result);</div>
<div class="line">    console.log(<span class="stringliteral">&#39;done&#39;</span>);</div>
<div class="line">    this.next();</div>
<div class="line">  }</div>
<div class="line">);</div>
<div class="line"></div>
<div class="line">mainFlow();</div>
</div><!-- fragment --><h3>Asynchronous Flow Execution</h3>
<p>A flow can be executed asynchronously.</p>
<div class="fragment"><div class="line">var flow = require(<span class="stringliteral">&#39;nue&#39;</span>).flow;</div>
<div class="line">var as = require(<span class="stringliteral">&#39;nue&#39;</span>).as;</div>
<div class="line">var fs = require(<span class="stringliteral">&#39;fs&#39;</span>);</div>
<div class="line"></div>
<div class="line">var subFlow = flow(<span class="stringliteral">&#39;subFlow&#39;</span>)(</div>
<div class="line">  <span class="keyword">function</span> readFile(file) {</div>
<div class="line">    fs.readFile(file, <span class="stringliteral">&#39;utf8&#39;</span>, this.async(as(1)));</div>
<div class="line">  }</div>
<div class="line">);</div>
<div class="line"></div>
<div class="line">var mainFlow = flow(<span class="stringliteral">&#39;mainFlow&#39;</span>)(</div>
<div class="line">  <span class="keyword">function</span> start() {</div>
<div class="line">    this.exec(subFlow, <span class="stringliteral">&#39;file1&#39;</span>, this.async(as(1)));</div>
<div class="line">    this.exec(subFlow, <span class="stringliteral">&#39;file2&#39;</span>, this.async(as(1)));</div>
<div class="line">  },</div>
<div class="line">  <span class="keyword">function</span> end(data1, data2) {</div>
<div class="line">    <span class="keywordflow">if</span> (this.err) <span class="keywordflow">throw</span> this.err;</div>
<div class="line">    console.log(data1 + data2);</div>
<div class="line">    console.log(<span class="stringliteral">&#39;done&#39;</span>);</div>
<div class="line">    this.next();</div>
<div class="line">  }</div>
<div class="line">);</div>
<div class="line"></div>
<div class="line">mainFlow();</div>
</div><!-- fragment --><h3>Parallel Flow</h3>
<p>In following example, the flow <code>par1-1</code> and <code>par1-2</code> are executed in parallel.</p>
<div class="fragment"><div class="line">var flow = require(<span class="stringliteral">&#39;nue&#39;</span>).flow;</div>
<div class="line">var parallel = require(<span class="stringliteral">&#39;nue&#39;</span>).parallel;</div>
<div class="line"></div>
<div class="line">var myFlow = flow(<span class="stringliteral">&#39;main&#39;</span>)(</div>
<div class="line">  <span class="keyword">function</span> one() {</div>
<div class="line">    console.log(this.stepName);</div>
<div class="line">    this.next(); </div>
<div class="line">  },</div>
<div class="line">  <span class="keyword">function</span> two() {</div>
<div class="line">    console.log(this.stepName);</div>
<div class="line">    this.next(); </div>
<div class="line">  },</div>
<div class="line">  parallel(<span class="stringliteral">&#39;par1&#39;</span>)(</div>
<div class="line">    flow(<span class="stringliteral">&#39;par1-1&#39;</span>)(</div>
<div class="line">      <span class="keyword">function</span> three() {</div>
<div class="line">        console.log(this.stepName);</div>
<div class="line">        this.next(); </div>
<div class="line">      },</div>
<div class="line">      <span class="keyword">function</span> four() {</div>
<div class="line">        console.log(this.stepName);</div>
<div class="line">        this.next(); </div>
<div class="line">      }</div>
<div class="line">    ),</div>
<div class="line">    flow(<span class="stringliteral">&#39;par1-2&#39;</span>)(</div>
<div class="line">      <span class="keyword">function</span> five() {</div>
<div class="line">        console.log(this.stepName);</div>
<div class="line">        this.next(); </div>
<div class="line">      },</div>
<div class="line">      <span class="keyword">function</span> six() {</div>
<div class="line">        console.log(this.stepName);</div>
<div class="line">        this.next(); </div>
<div class="line">      }</div>
<div class="line">    )</div>
<div class="line">  ),</div>
<div class="line">  <span class="keyword">function</span> seven() {</div>
<div class="line">    console.log(this.stepName);</div>
<div class="line">    this.next(); </div>
<div class="line">  },</div>
<div class="line">  <span class="keyword">function</span> eight() {</div>
<div class="line">    console.log(this.stepName);</div>
<div class="line">    this.next(); </div>
<div class="line">  },</div>
<div class="line">  <span class="keyword">function</span> allDone() {</div>
<div class="line">    <span class="keywordflow">if</span> (this.err) <span class="keywordflow">throw</span> this.err;</div>
<div class="line">    console.log(this.stepName);</div>
<div class="line">    this.next();</div>
<div class="line">  }</div>
<div class="line">);</div>
<div class="line"></div>
<div class="line">myFlow();</div>
</div><!-- fragment --><p>Arguments to a parallel flow are passed to every forked functions. Parallel flow results are passed to a next funtion as an array. The array contains the results of forked functions.</p>
<div class="fragment"><div class="line">var flow = require(<span class="stringliteral">&#39;nue&#39;</span>).flow;</div>
<div class="line">var parallel = require(<span class="stringliteral">&#39;nue&#39;</span>).parallel;</div>
<div class="line"></div>
<div class="line">var myFlow = flow(<span class="stringliteral">&#39;main&#39;</span>)(</div>
<div class="line">  <span class="keyword">function</span> start() { </div>
<div class="line">    this.next(10, 20); </div>
<div class="line">  },</div>
<div class="line">  parallel(<span class="stringliteral">&#39;parallel&#39;</span>)(</div>
<div class="line">    <span class="keyword">function</span> add(x, y) { </div>
<div class="line">      this.next(x + y); </div>
<div class="line">    },</div>
<div class="line">    <span class="keyword">function</span> sub(x, y) { </div>
<div class="line">      this.next(x - y);</div>
<div class="line">    }</div>
<div class="line">  ),</div>
<div class="line">  <span class="keyword">function</span> end(results) {</div>
<div class="line">    <span class="keywordflow">if</span> (this.err) <span class="keywordflow">throw</span> this.err;</div>
<div class="line">    console.log(<span class="stringliteral">&#39;add result: &#39;</span> + results[0]); <span class="comment">// add result: 30 </span></div>
<div class="line">    console.log(<span class="stringliteral">&#39;sub result: &#39;</span> + results[1]); <span class="comment">// sub result: -10</span></div>
<div class="line">    this.next();</div>
<div class="line">  }</div>
<div class="line">);</div>
<div class="line"></div>
<div class="line">myFlow();</div>
</div><!-- fragment --><h3>Data Sharing Between Functions</h3>
<p>Each step in a flow can share data through <code>this.data</code>. <code>this.data</code> is shared in a same flow. A nesting flow and any nested flows can't share <code>this.data</code>.</p>
<div class="fragment"><div class="line">var flow = require(<span class="stringliteral">&#39;nue&#39;</span>).flow;</div>
<div class="line">var as = require(<span class="stringliteral">&#39;nue&#39;</span>).as;</div>
<div class="line">var fs = require(<span class="stringliteral">&#39;fs&#39;</span>);</div>
<div class="line"></div>
<div class="line">var myFlow = flow(<span class="stringliteral">&#39;myFlow&#39;</span>)(</div>
<div class="line">  <span class="keyword">function</span> readFiles(file1, file2) {</div>
<div class="line">    this.data.file1 = file1;</div>
<div class="line">    this.data.file2 = file2;</div>
<div class="line">    fs.readFile(file1, <span class="stringliteral">&#39;utf8&#39;</span>, this.async(as(1)));</div>
<div class="line">    fs.readFile(file2, <span class="stringliteral">&#39;utf8&#39;</span>, this.async(as(1)));</div>
<div class="line">  },</div>
<div class="line">  <span class="keyword">function</span> concat(data1, data2) {</div>
<div class="line">    this.next(data1 + data2);</div>
<div class="line">  },</div>
<div class="line">  <span class="keyword">function</span> end(data) {</div>
<div class="line">    <span class="keywordflow">if</span> (this.err) <span class="keywordflow">throw</span> this.err;</div>
<div class="line">    console.log(data);</div>
<div class="line">    console.log(this.data.file1 + <span class="stringliteral">&#39; and &#39;</span> + <span class="keyword">this</span>.data.file2 + <span class="stringliteral">&#39; are concatenated.&#39;</span>);</div>
<div class="line">    this.next();</div>
<div class="line">  }</div>
<div class="line">);</div>
<div class="line"></div>
<div class="line">myFlow(<span class="stringliteral">&#39;file1&#39;</span>, <span class="stringliteral">&#39;file2&#39;</span>);</div>
</div><!-- fragment --><h3>Error Handling</h3>
<p>In a last step in a flow, <code>this.err</code> represents an error which is thrown with <code>throw</code>, passed to <code>this.endWith</code> or passed to an async callback as first argument. To indicate error handling is completed, you must assign <code>null</code> to <code>this.err</code>.</p>
<div class="fragment"><div class="line">var flow = require(<span class="stringliteral">&#39;nue&#39;</span>).flow;</div>
<div class="line">var as = require(<span class="stringliteral">&#39;nue&#39;</span>).as;</div>
<div class="line">var fs = require(<span class="stringliteral">&#39;fs&#39;</span>);</div>
<div class="line"></div>
<div class="line">var myFlow = flow(<span class="stringliteral">&#39;myFlow&#39;</span>)(</div>
<div class="line">  <span class="keyword">function</span> readFiles(file1, file2) {</div>
<div class="line">    fs.readFile(file1, <span class="stringliteral">&#39;utf8&#39;</span>, this.async(as(1)));</div>
<div class="line">    fs.readFile(file2, <span class="stringliteral">&#39;utf8&#39;</span>, this.async(as(1)));</div>
<div class="line">  },</div>
<div class="line">  <span class="keyword">function</span> concat(data1, data2) {</div>
<div class="line">    this.next(data1 + data2);</div>
<div class="line">  },</div>
<div class="line">  <span class="keyword">function</span> end(data) {</div>
<div class="line">    <span class="keywordflow">if</span> (this.err) {</div>
<div class="line">      <span class="comment">// handle error</span></div>
<div class="line">      console.log(this.err.message);</div>
<div class="line">      <span class="comment">// indicate error handling completion</span></div>
<div class="line">      this.err = null;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      console.log(data);</div>
<div class="line">    }</div>
<div class="line">    console.log(<span class="stringliteral">&#39;done&#39;</span>);</div>
<div class="line">    this.next();</div>
<div class="line">  }</div>
<div class="line">);</div>
<div class="line"></div>
<div class="line">myFlow(<span class="stringliteral">&#39;file1&#39;</span>, <span class="stringliteral">&#39;non-existent-file&#39;</span>);</div>
</div><!-- fragment --><h3>Unit Test with Mocha</h3>
<p>Following example shows how to test a flow and a function with <a href="http://visionmedia.github.com/mocha/">Mocha</a>.</p>
<div class="fragment"><div class="line">var flow = require(<span class="stringliteral">&#39;nue&#39;</span>).flow;</div>
<div class="line">var as = require(<span class="stringliteral">&#39;nue&#39;</span>).as;</div>
<div class="line">var fs = require(<span class="stringliteral">&#39;fs&#39;</span>);</div>
<div class="line"></div>
<div class="line">var concatFiles = flow(</div>
<div class="line">  <span class="keyword">function</span> (file1, file2) {</div>
<div class="line">    fs.readFile(file1, <span class="stringliteral">&#39;utf8&#39;</span>, this.async(as(1)));</div>
<div class="line">    fs.readFile(file2, <span class="stringliteral">&#39;utf8&#39;</span>, this.async(as(1)));</div>
<div class="line">  },</div>
<div class="line">  <span class="keyword">function</span> (data1, data2) {</div>
<div class="line">    this.next(data1 + data2);</div>
<div class="line">  }</div>
<div class="line">);</div>
<div class="line"></div>
<div class="line"><span class="keyword">function</span> read(file) {</div>
<div class="line">  fs.readFile(file, <span class="stringliteral">&#39;utf8&#39;</span>, this.async(as(1)));</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">var assert = require(<span class="stringliteral">&#39;assert&#39;</span>);</div>
<div class="line"></div>
<div class="line">describe(<span class="stringliteral">&#39;flow `concatFiles`&#39;</span>, <span class="keyword">function</span> () {</div>
<div class="line">  it(<span class="stringliteral">&#39;can be tested&#39;</span>, <span class="keyword">function</span> (done) {</div>
<div class="line">    flow(</div>
<div class="line">      concatFiles,</div>
<div class="line">      <span class="keyword">function</span> (data) {</div>
<div class="line">        <span class="keywordflow">if</span> (this.err) <span class="keywordflow">throw</span> this.err;</div>
<div class="line">        assert.strictEqual(data, <span class="stringliteral">&#39;FILE1FILE2&#39;</span>);</div>
<div class="line">        done();</div>
<div class="line">      }</div>
<div class="line">    )(<span class="stringliteral">&#39;file1&#39;</span>, <span class="stringliteral">&#39;file2&#39;</span>);</div>
<div class="line">  });</div>
<div class="line">});</div>
<div class="line"></div>
<div class="line">describe(<span class="stringliteral">&#39;function `read`&#39;</span>, <span class="keyword">function</span> () {</div>
<div class="line">  it(<span class="stringliteral">&#39;can be tested&#39;</span>, <span class="keyword">function</span> (done) {</div>
<div class="line">    flow(</div>
<div class="line">      read,</div>
<div class="line">      <span class="keyword">function</span> (data) {</div>
<div class="line">        <span class="keywordflow">if</span> (this.err) <span class="keywordflow">throw</span> this.err;</div>
<div class="line">        assert.strictEqual(data, <span class="stringliteral">&#39;FILE1&#39;</span>);</div>
<div class="line">        done();</div>
<div class="line">      }</div>
<div class="line">    )(<span class="stringliteral">&#39;file1&#39;</span>);</div>
<div class="line">  });</div>
<div class="line">});</div>
</div><!-- fragment --><h2>Debugging</h2>
<p>Use <code>NODE_DEBUG=nue</code>.</p>
<h3>Example</h3>
<blockquote class="doxtable">
<p>hoge.js </p>
</blockquote>
<div class="fragment"><div class="line">var flow = require(<span class="stringliteral">&#39;nue&#39;</span>).flow;</div>
<div class="line"></div>
<div class="line">flow(<span class="stringliteral">&#39;hoge&#39;</span>)(</div>
<div class="line">  <span class="keyword">function</span> add(x, y) {</div>
<div class="line">    this.next(x + y);</div>
<div class="line">  },</div>
<div class="line">  <span class="keyword">function</span> done(result) {</div>
<div class="line">    <span class="keywordflow">if</span> (this.err) <span class="keywordflow">throw</span> this.err;</div>
<div class="line">    console.log(result);</div>
<div class="line">  }</div>
<div class="line">)(10, 20);</div>
</div><!-- fragment --><blockquote class="doxtable">
<p>Run and Output </p>
</blockquote>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ NODE_DEBUG=nue node hoge.js</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;NUE: begin TOP_LEVEL_FLOW. flow: hoge(0), calledAt: /private/tmp/hoge.js:11:1, args: [ 10, 20 ]</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;NUE: begin STEP. flow: hoge(0), step: add(0), args: [ 10, 20 ]</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;NUE: begin STEP. flow: hoge(0), step: done(1), args: [ 30 ]</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;30</div>
</div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.10
</small></address>
</body>
</html>
